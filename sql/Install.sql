/*
DROP DATABASE IF EXISTS TRN;
*/
/*DB_TRN
 */
CREATE DATABASE TRN;
 
 /*Seleccion de DB
 */
USE TRN;

/*TRN_USUARIOS
Descripción: Datos actuales de usuarios. 
*/
CREATE TABLE TRN_LKP_USUARIOS (
ID_USER					INT  			NOT NULL AUTO_INCREMENT PRIMARY KEY,
NOMBRE 					VARCHAR(50) 	NOT NULL,
APELLIDOS 				VARCHAR(50) 	NOT NULL,
FECHA_DE_NACIMIENTO 	DATE 			NOT NULL,
EMAIL 					VARCHAR(50) 	NOT NULL UNIQUE,
PASSWORD				VARCHAR(50) 	NOT NULL,
DEPORTISTA 				TINYINT 		NOT NULL DEFAULT 0,
PESO					NUMERIC(3,1)	,
ALTURA					NUMERIC(3,0)	,
PERFIL  				INT				NOT NULL DEFAULT 1
)ENGINE=INNODB;
INSERT INTO TRN_LKP_USUARIOS (NOMBRE,APELLIDOS,FECHA_DE_NACIMIENTO,EMAIL,PASSWORD,PERFIL)VALUES("ADMIN","ADMINIS",STR_TO_DATE("19/10/1990",'%d/%m/%Y'),"admin@trn.com",MD5("admin"),6);
INSERT INTO TRN_LKP_USUARIOS (NOMBRE,APELLIDOS,FECHA_DE_NACIMIENTO,EMAIL,PASSWORD,PERFIL)VALUES("Jose Francisco","López Gil",STR_TO_DATE("19/10/1990",'%d/%m/%Y'),"josefranciscolopezgil@gmail.com",MD5("trn2016"),4);
INSERT INTO TRN_LKP_USUARIOS (NOMBRE,APELLIDOS,FECHA_DE_NACIMIENTO,EMAIL,PASSWORD,PERFIL)VALUES("Prueba1","Prueba1",STR_TO_DATE("19/10/1990",'%d/%m/%Y'),"Prueba1@trn.com",MD5("trn2016"),5);

/*TRN_LKP_ROLES_SEGURIDAD
Descripción: Tabla que almacena la configuración de los roles de seguridad.
*/
CREATE TABLE TRN_LKP_ROLES_SEGURIDAD(
ID_PERFIL				INT				NOT NULL AUTO_INCREMENT PRIMARY KEY,
DESC_PERFIL 			VARCHAR(20) 	NOT NULL,
BACKEND 				TINYINT 		NOT NULL DEFAULT 0,
OBJETIVOS 				TINYINT 		NOT NULL DEFAULT 0,
SEGUIMIENTO 			TINYINT 		NOT NULL DEFAULT 0
)ENGINE=INNODB;
INSERT INTO TRN_LKP_ROLES_SEGURIDAD (DESC_PERFIL,BACKEND,OBJETIVOS,SEGUIMIENTO) VALUES ('Usuario',0,0,0);
INSERT INTO TRN_LKP_ROLES_SEGURIDAD (DESC_PERFIL,BACKEND,OBJETIVOS,SEGUIMIENTO) VALUES ('Administrativo',1,0,0);
INSERT INTO TRN_LKP_ROLES_SEGURIDAD (DESC_PERFIL,BACKEND,OBJETIVOS,SEGUIMIENTO) VALUES ('Asistente',1,0,1);
INSERT INTO TRN_LKP_ROLES_SEGURIDAD (DESC_PERFIL,BACKEND,OBJETIVOS,SEGUIMIENTO) VALUES ('Coach',1,1,1);
INSERT INTO TRN_LKP_ROLES_SEGURIDAD (DESC_PERFIL,BACKEND,OBJETIVOS,SEGUIMIENTO) VALUES ('Administrador',1,1,1);
INSERT INTO TRN_LKP_ROLES_SEGURIDAD (DESC_PERFIL,BACKEND,OBJETIVOS,SEGUIMIENTO) VALUES ('MASTER',1,1,1);



/* TRN_WEB_ACCESOS
Descripción: Tabla que almacena todos los accesos
*/
CREATE TABLE TRN_WEB_ACCESOS(
ID_ACCESO				INT				NOT NULL AUTO_INCREMENT PRIMARY KEY,
ID_USER					INT				NOT NULL,
FECHA_ACCESO			DATE			NOT NULL,
IP						VARCHAR(20)		NOT NULL,
WEB						TINYINT			NOT NULL DEFAULT 0,
APP						TINYINT			NOT NULL DEFAULT 0,
INDEX (ID_USER),
FOREIGN KEY (ID_USER) REFERENCES TRN_LKP_USUARIOS (ID_USER)
)ENGINE=INNODB;


/*TRN_B_OBJETIVOS
Descripción: Tabla que almacena los distintos objetivos de los usuarios. (De momento solo objetivos de peso, ¿Jerarquía de Objetivos?)
*/
CREATE TABLE TRN_LKP_OBJETIVOS(
ID_OBJETIVO				INT				NOT NULL AUTO_INCREMENT PRIMARY KEY,
ID_USER					INT				NOT NULL,
FECHA_INICIO			DATE			NOT NULL,
PROGRESO				NUMERIC(2,1)    NOT NULL DEFAULT 0,
PESO_OBJETIVO			NUMERIC(3,1)	NOT NULL DEFAULT 0,
PESO_INICIO				NUMERIC(3,1)	NOT NULL DEFAULT 0,
PESO_ACTUAL				NUMERIC(3,1)	NOT NULL DEFAULT 0,
DIAS_ENTRENO			VARCHAR(10)		NOT NULL DEFAULT '1010100',
PATOLOGIAS				VARCHAR(250)	,
ALIMENTOS_ND			VARCHAR(250)	,
OBJETIVOS				VARCHAR(500)	NOT NULL,
INDEX (ID_USER),
FOREIGN KEY (ID_USER) REFERENCES TRN_LKP_USUARIOS (ID_USER)
)ENGINE=INNODB;

INSERT INTO TRN_LKP_OBJETIVOS (ID_USER,FECHA_INICIO,PROGRESO,PESO_OBJETIVO,PESO_INICIO,PESO_ACTUAL,DIAS_ENTRENO,OBJETIVOS) VALUES (3,STR_TO_DATE("26/09/2016",'%d/%m/%Y'),10.5,77.5,89.5,88.5,"MXD","Bajar % de grasa corporal a 8%.");

/*TRN_LKP_SEGUIMIENTOS
Descripción: Tabla que almacena el seguimiento de un objetivo asociado a un usuario.
*/
CREATE TABLE TRN_B_SEGUIMIENTOS(
ID_SEGUIMIENTO			INT 			NOT NULL AUTO_INCREMENT PRIMARY KEY,
ID_OBJETIVO				INT				NOT NULL,
PESO					NUMERIC(3,1)	NOT NULL,
FOTO_FRONTAL			VARCHAR(250)	NOT NULL,
FOTO_ESPALDA			VARCHAR(250)	NOT NULL,
FOTO_PERFIL				VARCHAR(250)	NOT NULL,
COMENTARIOS				VARCHAR(250)	,
FOREIGN KEY (ID_OBJETIVO) REFERENCES TRN_LKP_OBJETIVOS (ID_OBJETIVO)
)ENGINE=INNODB;


/*TRN_B_ESTADO_USUARIOS
Descripción: Historificación del estado del usuario (Todos los elementos a historificar con periodicidad de un día).
*/
CREATE TABLE TRN_B_ESTADO_USUARIOS(
ID_FECHA				DATE			NOT NULL,
ID_USER					INT 			NOT NULL,
PESO					NUMERIC(3,1)    NOT NULL,
FOTO					VARCHAR(50)		,
PRIMARY KEY ( ID_USER , ID_FECHA ),
FOREIGN KEY (ID_USER) REFERENCES TRN_LKP_USUARIOS (ID_USER)
)ENGINE=INNODB;